<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grand Guide - WikiForm</title>
    <link rel="stylesheet" href="protect.css">

</head>
<body>
    <div class="container">
        <h1>Item Management</h1>
        <button id="addItemButton" class="button">Add Item</button>
        <button id="editItemButton" class="button">Edit Item</button>

        <!-- Add Item Form -->
        <div id="addItemForm" class="hidden">
            <h2>Add New Item</h2>
            <form id="itemForm">
                <div class="form-container">
                    <!-- Add item inputs (ID, Name, etc.) -->
                    <div class="form-group">
                        <label for="id">ID:</label>
                        <input type="text" id="id" name="id" required>
                    </div>
                    <div class="form-group">
                        <label for="name">Name:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="cover">Cover URL:</label>
                        <input type="text" id="cover" name="cover" required>
                    </div>
                    <!-- Add other fields similarly -->
                </div>
                <button type="submit" class="button">Submit</button>
            </form>
        </div>

        <!-- Edit Item Form -->
        <div id="searchContainer" class="hidden">
            <h2>Edit Existing Item</h2>
            <input type="text" id="searchBox" placeholder="Search items...">
            <div id="itemList"></div>
            <div id="editItemForm" class="hidden"></div>
        </div>
    </div>

    <script>
        window.onload = function() {
            const authToken = sessionStorage.getItem('authToken');
            if (authToken) {
                document.querySelector('.container').style.display = 'block';
            } else {
                window.location.href = '/';
            }
        };

        document.getElementById('addItemButton').addEventListener('click', function() {
            document.getElementById('addItemForm').classList.remove('hidden');
            document.getElementById('searchContainer').classList.add('hidden');
        });

        document.getElementById('editItemButton').addEventListener('click', async function() {
            document.getElementById('addItemForm').classList.add('hidden');
            document.getElementById('searchContainer').classList.remove('hidden');
            const response = await fetch('https://raw.githubusercontent.com/Grand-Guide/Grand-Guide.github.io/main/public/pages/items/items.json');
            const items = await response.json();
            const itemList = document.getElementById('itemList');
            itemList.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.textContent = item.name;
                div.dataset.id = item.id;
                itemList.appendChild(div);
            });

            // Evento ao clicar no item da lista
            itemList.addEventListener('click', function(event) {
                if (event.target.dataset.id) {
                    const selectedItemId = event.target.dataset.id;
                    loadEditForm(selectedItemId, items);
                }
            });
        });

        function loadEditForm(itemId, items) {
            const item = items.find(item => item.id === itemId);
            const editFormContainer = document.getElementById('editItemForm');
            editFormContainer.innerHTML = `
                <h2>Edit Item: ${item.name}</h2>
                <form id="editForm">
                    <div class="form-container">
                        <div class="form-group">
                            <label for="editId">ID:</label>
                            <input type="text" id="editId" name="id" value="${item.id}" readonly>
                        </div>
                        <div class="form-group">
                            <label for="editName">Name:</label>
                            <input type="text" id="editName" name="name" value="${item.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="editCover">Cover URL:</label>
                            <input type="text" id="editCover" name="cover" value="${item.cover}" required>
                        </div>
                        <!-- Add other fields similarly -->
                    </div>
                    <button type="submit" class="button">Update</button>
                </form>
            `;
            editFormContainer.classList.remove('hidden');

            document.getElementById('editForm').addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(this);
                const updatedItemData = {};
                formData.forEach((value, key) => {
                    updatedItemData[key] = value;
                });
                console.log('Updated item data:', updatedItemData);
                document.getElementById('editItemForm').innerHTML += '<p>Item atualizado com sucesso!</p>';
            });
        }
    </script>
</body>
</html>